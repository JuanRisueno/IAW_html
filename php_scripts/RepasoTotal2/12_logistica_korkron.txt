Ejercicio 12: Log√≠stica Kor'kron (Versi√≥n FINAL) üõ°Ô∏èüî•

Archivos: 12_funciones.php, 12_login.php, 12_panel.php, 12_logout.php. Dificultad: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Nivel "Jefe de Banda M√≠tico")

üìú Trasfondo

El Intendente necesita aprobar env√≠os de suministros. El sistema debe ser seguro, validar cada dato al mil√≠metro y calcular costes variables seg√∫n la urgencia.

üìù Instrucciones Detalladas:

1. 12_funciones.php (Librer√≠a)

Funci√≥n: calcular_coste_total($tipo_tropa, $cantidad, $num_suministros, $prioridad):

    Coste Tropas: Grunts (10), Incursores (20), Chamanes (50).

    Coste Suministros: Cada suministro extra suma 5 monedas.

    Coste Prioridad (Radio):

        Si es "normal": +0 monedas.

        Si es "urgente": +50 monedas (Tasa de velocidad Goblin).

    Devuelve: El coste total.

2. 12_login.php (La Puerta)

    HTML: Usuario y Contrase√±a.

    PHP: Valida usuario "Thrall" y contrase√±a "horda".

    Acci√≥n: Si OK -> session_start + Redirecci√≥n a 12_panel.php.

3. 12_panel.php (El Monstruo de las Validaciones)

Seguridad: Si no hay sesi√≥n (empty($_SESSION...)), header al login y exit.

A. Formulario HTML:

    C√≥digo Misi√≥n: Texto (Ej: M-104).

    Email Oficial: Texto.

    Fecha Despliegue: Date.

    Tipo Tropa: Select (Grunts, Incursores, Chamanes).

    Prioridad: Radio Button ("Normal", "Urgente").

    Suministros: Checkbox M√∫ltiple (Armas, Armaduras, Comida).

    Cantidad: N√∫mero.

    Clave Autorizaci√≥n: Password.

    Bot√≥n: "Cerrar Sesi√≥n" (a 12_logout.php).

B. Validaciones PHP (Estrictas):

    C√≥digo: Obligatorio. Regex: /^M-\d{3}$/ (Empieza por M- y 3 d√≠gitos).

    Email: Obligatorio. filter_var con FILTER_VALIDATE_EMAIL.

    Fecha: Obligatoria. No puede ser anterior a hoy.

    Tropa (Select): Obligatoria. Validar contra array (in_array).

    Prioridad (Radio): Obligatoria. Validar contra array (normal, urgente).

    Suministros (Checkbox): Opcional. Si se marca, validar que los valores son correctos (array_diff).

    Cantidad: Obligatorio. Entero positivo (filter_var INT).

    Clave: Obligatoria.

        Regex: /^(?=.*[A-Za-z])(?=.*\d).{8,}$/ (8 chars, 1 letra, 1 n√∫mero).

        Si es v√°lida -> Generar Hash.

C. Resultado:

    Sticky Form: Mantener TODOS los datos si falla (incluido el radio marcado y los checkboxes).

    √âxito:

        Mostrar mensaje de aprobaci√≥n.

        Mostrar Hash de la clave.

        Llamar a la funci√≥n y mostrar: "Coste Total: X oro".

4. 12_logout.php (Salida)

    Borrado de variables ($_SESSION = []).

    Borrado de Cookie (bloque setcookie).

    Destrucci√≥n (session_destroy).

    Redirecci√≥n al Login.